#
# PIAACMC coronagraph
#
start
	telescope
	primaryDiameter:16.195
	primaryFRatio:19.72
end
# start here defining the input E-field
start
	efield
	setSize:2048, 2048, 1
	pointSource:1.0, 0.0, 0.0
# three sources making a triangle of radius 0.004 l/D
#	pointSource:0.33333333333, 0.004, 0.0
#	pointSource:0.33333333333, -0.002, 0.003464101615138
#	pointSource:0.33333333333, -0.002, 0.003464101615138
# three sources making a triangle of radius 0.008 l/D
#	pointSource:0.33333333333, 0.008, 0.0
#	pointSource:0.33333333333, -0.004, 0.006928203230276
#	pointSource:0.33333333333, -0.004, -0.006928203230276
#	pointSource:1e-7, 3.0, 1.0
	wavelength:1.3e-6
#	wavelength:1.235e-06
#	wavelengthBandwidth: 1.3e-6, 0.1, 5
	beamRadiusPhysical:0.0188474
	pixelScale:0.00003916814414
end
# ------------------------
# the coronagraph
# ------------------------
start
	coronagraph
	start
		mask
		filename:segmented/pupil_2048.fits
		position:0
		# give it a name
		name:entrance pupil
	end
	start
		mirror
		filename:segmented/piaam0z.fits
		position:0
		# give it a name
		name:PIAA m0
#		draw:onInit
	end
	start
		fresnelPropagator
		# give it a name
		name:propagrator from PIAA m0 to PIAA m1
		propagationSign:1
#		draw:preExecute
#		draw:postExecute
#		save:postExecute
	end
	start
		mirror
		filename:segmented/piaam1z.fits
		position:0.405000
		# give it a name
		name:PIAA m1
#		save:postExecute
#		draw:onInit
	end
	# mask element
	start
		mask
		filename:segmented/dans_stopPup.fits
		position:0.405000
		# give it a name
		name:PIAA m1 mask
#		save:postExecute
#		draw:onInit
	end
	start
		fpmPupToLyot
		name:FPM
		position:0.405000
		focalRatio: 85.9
		fRatioSign: -1
		zoomFftSign: -1
		disableForCalibration:on
		start
			fpmIntHexCMCForPupToLyot
			zoomFactor: 8
			start
				complexHexMaskFPM
				name:complexHexMaskFPM
				maskNRings: 8
				hexStep: 1
				fpmArraySize: 2048
				fpmScaleFactor: 0.9
				hexGap: -0.0001
				phaseSign: -1
				lambdaRef: 1.3e-6
#				lambdaRef: 1.235e-06
				fpmFRatio: 85.9
				nSubPix: 64
				# fpm radius = 2 f*lambdaRef/D = 2*lambdaRef*fpmFRatio
				fpmRadius: 2.2334e-04
#				sagFilename:segmented/8Rings/luvior_olivier_sags.fits
				sagFilename:segmented/8Rings/monoTest/bestOptVector.fits
#				sagFilename:segmented/8Rings/monoTest/Luvior_mono_best.fits
				maskFilenameRoot:segmented/8Rings/luvior_base_mask_data
			end
		end
#		draw:postExecute
#		save:preExecute
#		save:postExecute
	end
#	start
#		breakExecution
#	end
	start
		fresnelPropagator
		# give it a name
		name:propagrator from FPM to pupil
		propagationSign:-1
#		draw:preExecute
#		draw:postExecute
#		save:postExecute
	end
	start
		mask
		filename:segmented/LyotStop0.fits
		position:-0.186422
		# give it a name
		name:Lyot mask 0
#		save:postExecute
#		draw:postExecute
#		draw:onInit
	end
	start
		fresnelPropagator
		# give it a name
		name:propagrator from FPM to pupil
		propagationSign:1
#		draw:preExecute
#		draw:postExecute
#		save:postExecute
	end
	start
		mask
		filename:segmented/LyotStop1.fits
		position:0.173206
		# give it a name
		name:Lyot mask 0
#		save:postExecute
#		draw:postExecute
#		draw:onInit
	end
	start
		fraunhoferFocal
		position:0
		name:science CCD
		referenceLambda:1.3e-6
		samplesPerflD:2.2
		FOVflD:965
#		save:postExecute
#		draw:postExecute
#		draw:preExecute
	end
end
#start
#	execute
#end
#start
#	makeContrastCurve
#	filename:contrastCurve_olivier.txt
#	draw:on
#	drawTo:12.0
#end
start
	regionContrast
	referenceLambda:1.3e-6
	radii:2,8
#	radii:1,3
#	anglesInDegrees:-20,20
	anglesInDegrees:-90,90
	filename:regionContrast.txt
	draw:on
end
#start
#	makeHexCFpmResponse
#	DataToOptimize:FPM,sags
#	outputDirectory:segmented/responseData
#	start
#		regionContrast
#		referenceLambda:1.3e-6
#		radii:2,8
#		anglesInDegrees:-90,90
#	end
#end

