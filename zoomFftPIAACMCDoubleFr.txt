#
# PIAACMC coronagraph
#
start
	telescope
	primaryDiameter:2.4
	primaryFRatio:15.1
end
# start here defining the input E-field
start
	efield
	outputDirectory:testData/olivierPIAACMC/
	setSize:1024, 1024, 1
	referenceWavelength:5.565e-07
#	wavelength:5.39575e-07
	wavelength:5.62175e-07
#	wavelengthList: 5.39575e-07 5.45225e-07 5.50875e-07 5.56525e-07 5.62175e-07 5.67825e-07 5.73475e-07 5.79125e-07 5.84775e-07 5.90425e-07
	beamRadiusPhysical:0.022
	pixelScale:1.100e-04
#	constantValue:1
	pointSource:1.0, 0.0, 0.0
#	pointSource:1e-5, 1e-4, 0.0
#	pointSource:1e-6, -0.8e-4, -0.8e-4
	end
# ------------------------
# the coronagraph
# ------------------------
start
	coronagraph
	start
		mask
		filename:c1/pup_1024.fits
		position:0
		# give it a name
		name:entrance pupil
		save:preExecute
	end
#	start
#		mirror
#		filename:c1/dans_abberr.fits
#		position:0
#		# give it a name
#		name:TT mirror
#	end
	# fresnel propagator
	start
		fresnelPropagator
		# give it a name
		name:propagrator from TT mirror to PIAA m0
		propagationSign:1
#		draw:preExecute
#		draw:postExecute
#		save:preExecute
#		save:postExecute
	end
	start
		mirror
		filename:c1/piaam0z.fits
		position:1.199997
		# give it a name
		name:PIAA m0
#		draw:onInit
#		save:preExecute
	end
	start
		fresnelPropagator
		# give it a name
		name:propagrator from PIAA m0 to PIAA m1
		propagationSign:-1
#		draw:preExecute
#		draw:postExecute
#		save:preExecute
#		save:postExecute
end
	start
		mirror
		filename:c1/piaam1z.fits
		position:-1.102609
		# give it a name
		name:PIAA m1
#		save:preExecute
#		save:postExecute
#		draw:onInit
	end
	# mask element
	start
		mask
		filename:c1/dans_piaam1Mask.fits
		position:-1.102609
		# give it a name
		name:PIAA m1 mask
#		save:preExecute
#		save:postExecute
#		draw:onInit
	end
	start
		doubleFraunhoferFPM
		name:doubleFraunhoferFPM
		position:-1.102609
		disableForCalibration:on
		zoomFactor: 16
		padFactor: 10
		maskIndex: 4
		maskFilename:tmp_fpmCA_ampl.fits,tmp_fpmCA_pha.fits
#		save:preExecute
#		save:postExecute
#		break:postExecute
	end
	start
		mask
		filename:c1/dans_postFPMmask.fits
		position:-1.102609
		# give it a name
		name:post FPM mask
#		save:postExecute
#		draw:onInit
	end
	start
		fresnelPropagator
		# give it a name
		name:propagrator from FPM to pupil
		propagationSign:1
#		draw:preExecute
#		draw:postExecute
#		save:preExecute
#		save:postExecute
	end
	start
		mask
		filename:c1/LyotStop0.fits
		position:-0.092609
		# give it a name
		name:Lyot mask 0
#		save:preExecute
#		save:postExecute
#		draw:onInit
	end
	start
		mask
		filename:c1/dans_backEndPupStop.fits
		position:-0.092609
		# give it a name
		name:back-end pupil stop
#		save:preExecute
#		save:postExecute
#		draw:onInit
	end
	start 
		fraunhoferFocal
		position:0
		name:science CCD
		referenceLambda:5.65e-07
		samplesPerflD:2.4
		FOVflD:418
#		save:preExecute
#		save:postExecute
#		draw:postExecute
#		draw:preExecute
	end
end
#start
#	execute
#end
start
	makeContrastCurve
	filename:contrastCurve.txt
	draw:on
	drawTo:12.0
end


